<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Onix Secure Browser</title>
    <style>
        body {
            padding-top: 50px;
            font-family: Arial, Helvetica, sans-serif;
            background-color: lightgray;
        }
        header {
            position: fixed;
            background-color: gray;
            left: 50%;
            width: 80%;
            opacity: 0.9;
            backdrop-filter: blur(100px);
	        transform: translateX(-50%);
            top: 4px;
            border-radius: 20px;
            padding: 5px;
            align-items: center;
            display: flex;
            z-index: 10000;
        }
        button {
            background-color: darkgray;
            transition: all 0.3s ease;
            border-radius: 5px;
            margin-right: 5px;
            padding: 5px;
            color: inherit;
            text-decoration: none;
            border: none;
            cursor: pointer;
        }
        button:hover {
            filter:brightness(0.7);
            transition: filter 0.3s ease;
        }
        a {
            background-color: darkgray;
            transition: all 0.3s ease;
            border-radius: 5px;
            padding: 5px;
            color: inherit;
            text-decoration: none;
            border: none;
            cursor: pointer;
        }
        a:hover {
            filter:brightness(0.7);
            transition: filter 0.3s ease;
        }
        .home {
            margin-right: 10px;
        }
        .paragraph {
            text-align: center;
            border-radius: 10px;
            background-color: gray;
            padding: 20px;
        }
    </style>
    <script>
        function blankify() {
            const website = window.open("about:blank")
            website.document.write(document.documentElement.outerHTML)
            website.document.close()
            window.location.href = "https://launchpad.classlink.com"
        }
    </script>
    <header>
        <img class="home" src="/icon.svg" height="40" onclick="window.location.href='/'">
        <button onclick="window.location.href='https://gixtuh.vercel.app'">official website</button>
    </header>
    <title>slope</title>
    <link rel="icon" href="/icon.svg">
</head>
<body>
    <h1>Onix Secure Browser</h1>
    
    <!-- Custom URL input -->
    <div class="url-bar">
        <input type="text" id="custom-url" placeholder="Enter custom URL here">
        <button id="go-btn">Go</button>
    </div>
    
    <div class="websocket">
        <input type="text" id="custom-websocket" placeholder="Enter custom websocket here.">
        <button id="use-btn">Use</button>
        <button id="default-btn">Default</button>
    </div>
    
    <!-- Preset buttons -->
    <div>
        <button>https://example.com</button>
        <button>https://wikipedia.org</button>
        <button>https://search.brave.com</button>
        <button>https://ifconfig.me</button>
        <button>https://tenor.com</button>
    </div>
    <br />
    <button onclick="iframe.requestFullscreen()">Fullscreen</button>
    
    
    <p id="status">Connecting...</p>
    <iframe id="viewer" height=640 sandbox="allow-scripts allow-forms allow-same-origin"></iframe>
    
    <script>
        let customwstext = "wss://onix-server-official.onrender.com";
        let ws = new WebSocket(customwstext);
        const status = document.getElementById('status');
        const iframe = document.getElementById('viewer');
        let currenturl;
        
        setInterval(() => {
            try {
                const loc = iframe.contentWindow.location;
                if (loc.protocol === "file:") {
                    console.warn("Detected file:// protocol ‚Äî switching back to HTTPS!");
                    const safeUrl = "https://" + loc.hostname + loc.pathname + loc.search + loc.hash;
                    ws.send(safeUrl)
                }
            } catch (err) {
                const loc = new URL(currenturl)
                console.warn("Detected file:// protocol ‚Äî switching back to HTTPS!");
                const safeUrl = "https://" + loc.hostname + loc.pathname + loc.search + loc.hash;
                ws.send(safeUrl)
            }
        }, 500);
        
        // üîÅ Function to bind listeners to a given socket
        function bindSocket(socket) {
            socket.addEventListener("open", () => {
                setTimeout(() => {
                    status.textContent = `‚úÖ Connected to ${socket.url}`;
                }, 500)
            });
            
            socket.addEventListener("close", () => {
                status.textContent = "‚ùå Disconnected.";
            });
            
            socket.addEventListener("error", (err) => {
                console.error(err);
                status.textContent = "‚ö†Ô∏è WebSocket error. Check URL.";
            });
            
            socket.addEventListener("message", (event) => {
                iframe.srcdoc = event.data;
                iframe.onload = () => {
                    try {
                        const iframeWin = iframe.contentWindow;
                        const iframeDoc = iframeWin.document;
                        const baseOrigin = parent.location.origin.replace(/^file:/, "https:");
                        
                        const sendSmartURL = (url) => {
                            let resolved;
                            try {
                                // absolute URL
                                resolved = new URL(url).href;
                            } catch {
                                // relative URL fallback
                                if (!currenturl || !currenturl.startsWith('http')) currenturl = 'https://example.com/';
                                resolved = new URL(url, currenturl).href;
                            }
                            currenturl = resolved;
                            status.textContent = `üåê Loading ${resolved}`;
                            ws.send(resolved);
                        };
                        
                        // Links
                        iframeDoc.querySelectorAll('a[href]').forEach(a => {
                            a.addEventListener('click', (e) => {
                                e.preventDefault();
                                sendSmartURL(a.getAttribute('href'));
                            });
                        });
                        
                        // Inline onclick="window.location.href='...'"
                        iframeDoc.querySelectorAll('[onclick]').forEach(el => {
                            const old = el.onclick;
                            el.onclick = (e) => {
                                e.preventDefault();
                                try {
                                    const onclickAttr = el.getAttribute('onclick') || '';
                                    const hrefRegex = /window\.location\.href\s*=\s*['"]([^'"]+)['"]/g;
                                    let match;
                                    while ((match = hrefRegex.exec(onclickAttr)) !== null) {
                                        sendSmartURL(match[1]);
                                    }
                                    return old?.call(el, e);
                                } catch {}
                            };
                        });
                        
                        // JS navigation
                        const loc = iframeWin.location;
                        ['assign','replace'].forEach(method => {
                            const orig = loc[method].bind(loc);
                            loc[method] = (url) => { sendSmartURL(url); return orig(url); };
                        });
                        
                        // Form submissions
                        iframeDoc.querySelectorAll('form').forEach(f => {
                            f.addEventListener('submit', (e) => {
                                e.preventDefault();
                                const action = f.getAttribute('action') || iframeWin.location.href;
                                const params = new URLSearchParams(new FormData(f)).toString();
                                const full = action.includes('?') ? `${action}&${params}` : `${action}?${params}`;
                                sendSmartURL(full);
                            });
                        });
                        
                        
                    } catch (err) {
                        console.warn('iframe sandbox blocked access:', err);
                    }
                };
            });
        }
        
        // connect the default socket
        bindSocket(ws);
        
        // handle preset buttons
        document.querySelectorAll('button').forEach(el => {
            const url = el.textContent.trim();
            if (!url.startsWith('http')) return; // skip the non-URL buttons
            el.addEventListener('click', () => {
                currenturl = url;
                status.textContent = `üåê Loading ${url}...`;
                ws.send(url);
            });
        });
        
        // custom URL input
        const input = document.getElementById('custom-url');
        document.getElementById('go-btn').addEventListener('click', () => {
            const url = input.value.trim();
            if (!url) return;
            currenturl = url;
            status.textContent = `üåê Loading ${url}...`;
            ws.send(url);
        });
        
        // custom WebSocket input ‚úÖ
        const customws = document.getElementById('custom-websocket');
        document.getElementById('use-btn').addEventListener('click', () => {
            const newWSText = customws.value.trim();
            if (!newWSText) return;
            
            status.textContent = `‚òÅÔ∏è Switching to ${newWSText}...`;
            
            try { ws.close(); } catch {}
            
            ws = new WebSocket(newWSText);
            bindSocket(ws);
        });
        document.getElementById('default-btn').addEventListener('click', () => {
            const newWSText = "wss://onix-server-official.onrender.com/";
            if (!newWSText) return;
            
            status.textContent = `‚òÅÔ∏è Switching to ${newWSText}...`;
            
            try { ws.close(); } catch {}
            
            ws = new WebSocket(newWSText);
            bindSocket(ws);
        });
        
        input.addEventListener('keypress', (e) => { if (e.key === 'Enter') document.getElementById('go-btn').click(); });
        customws.addEventListener('keypress', (e) => { if (e.key === 'Enter') document.getElementById('use-btn').click(); });
    </script>
    
</body>
</html>
